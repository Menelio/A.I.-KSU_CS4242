package RoutFinder;

public class AstarSearch {
	//edges and nodes to search
	private Node[] nodes;
	//current node in search
	private Node current;
	//goal node
	private Node goal;
	/**<h1>Constructor</h1>
	 * Creates an AstarSearch object based on given paramaters
	 * <p>
	 * @param nodes					: Node[] array of nodes to search through
	 * @precondition 				: Starting node must be first node in nodes and
	 * goal node must be last in nodes
	 * @postcondition				: an instance of the AstarSearch class has 
	 * been instantiated with nodes
	 *  */
	public AstarSearch(Node[] nodes) {
		this.nodes = nodes;
		this.current = nodes[0];//starting node must first
		this.goal = nodes[nodes.length-1];//goal node must be last
	}
	
	/**<h1>Step</h1>
	 * Step through search
	 * <p>
	 * @postcondition				: The A* search has been advance by one steps*/
	public void step() {
		
		/////////////////////debuggin
		System.out.println(current.name);
		for(int i=0; i<current.getEdges().length;i++) {
			System.out.println("  GN= "+current.getEdges()[i].getGn());
			System.out.println("  FirstN= "+current.getEdges()[i].getFirstNode().getName()+" h(n)="+current.getEdges()[i].getFirstNode().getHn());
			System.out.println("  SeconN= "+current.getEdges()[i].getSecondNode().getName()+" h(n)="+current.getEdges()[i].getSecondNode().getHn());
		}
		////////////////////debuggin
		
		if(!current.getName().equals(goal.getName())) {
			//edges of current node
			Edge[] edges = current.getEdges();
			
			//initialize f(n)
			int fn;
			if(!current.getEdges()[0].getFirstNode().getName().equals(current.getName())) {
			    fn= current.getEdges()[0].getGn()+current.getEdges()[0].getFirstNode().getHn();
			}else {
				fn= current.getEdges()[0].getGn()+current.getEdges()[0].getSecondNode().getHn();
			}
			//index of edge with lowest fn
			int index=0;
			//find index of edge with lowest f(n);
			for(int i=0;i<current.getEdges().length;i++) {
				if(!current.getEdges()[i].getFirstNode().getName().equals(current.getName())) {
					if( current.getEdges()[i].getGn()+current.getEdges()[i].getFirstNode().getHn()   < fn) {
						fn = current.getEdges()[i].getGn()+current.getEdges()[i].getFirstNode().getHn();
					}
				}else {
					if( current.getEdges()[i].getGn()+current.getEdges()[i].getSecondNode().getHn() < fn) {
						fn = current.getEdges()[i].getGn()+current.getEdges()[i].getSecondNode().getHn();
					}
				}
			}
			//set node with lowest f(n) as current
			if(!current.getName().equals(current.getEdges()[index].getFirstNode())) {
				/////////////////////////Debuggin
				System.out.println("        Flag1");
				/////////////////////////Debuggin
				current = current.getEdges()[index].getSecondNode();
			}else {
				/////////////////////////Debuggin
				System.out.println("Flag2");
				/////////////////////////Debuggin
				current = current.getEdges()[index].getFirstNode();
			}
		}
		
	}
	
}
